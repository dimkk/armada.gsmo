(function(){function y(n){if(n!==undefined&&n.getDate!==undefined){var t=n.getDate(),i=n.getMonth()+1,u=n.getFullYear(),f=n.getHours(),r=n.getMinutes();return t<10&&(t="0"+t),i<10&&(i="0"+i),r<10&&(r="0"+r),t+"."+i+"."+u+" "+f+":"+r}}function nt(n){if(n!==undefined){var t=n.split("/");return new Date(+t[2],t[1]-1,+t[0])}}function p(n){return n!=""&&!isNaN(n)}function tt(n,t,i){var u,r;return t==null||t==""?null:(u=$.grep(n,function(n){return n.name==t}),u.length==0)?(r=i.addItem(new SP.ListItemCreationInformation),r.set_item("Title",t),r.update(),$.appWebContext.load(r),t):null}function it(n,t){for(var f,r,u=[{name:"Выберите значение..."}],i=0;i<n.length;i++)if(n[i].get_internalName()==t){for(f=n[i].get_choices(),r=0;r<f.length;r++)u.push({name:f[r]});return u}return u}function rt(n){var i=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/getByTitle('ConfigurationList')/items(1)",r={__metadata:{type:"SP.Data.ConfigurationListListItem"},CurrentMeetingNumber:n},t=JSON.stringify(r);$.ajax({url:encodeURI(i),data:t,headers:{accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val(),"X-HTTP-Method":"MERGE","content-length":t.length,"content-type":"application/json;odata=verbose","If-Match":"*"},type:"POST",async:!1,success:function(){}})}function ut(){var n=0,t=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/getByTitle('ConfigurationList')/items(1)";return $.ajax({url:encodeURI(t),headers:{Accept:"application/json;odata=verbose"},method:"GET",async:!1,success:function(t){t.d&&(n=t.d.CurrentMeetingNumber)}}),n}function ft(n){for(var i="",r=new window.Uint8Array(n),u=r.byteLength,t=0;t<u;t++)i+=String.fromCharCode(r[t]);return i}function et(n){var u=$.appWebContext.get_web().get_lists().getByTitle("Вложения отчета по поручению"),e=[],o,f,s,r,h,i,t;for(o in n){f=n[o];for(s in f.assignmentReports()){r=f.assignmentReports()[s];for(h in r.reportAttachments())i=r.reportAttachments()[h],i._destroy?i.Id()!=""&&(t=u.getItemById(i.Id()),t.deleteObject()):i.Id()==""?(t=u.addItem(new SP.ListItemCreationInformation),t.set_item("AttachmentDescription",i.Descr()),t.set_item("AssignmentReportLink",r.Id()),t.set_item("AttachmentDocumentTypeLink",i.DType()),t.set_item("AttachmentIsForReport",i.IsForReport()),t.update(),e.push({spItem:t,koItem:i}),$.appWebContext.load(t)):(t=u.getItemById(i.Id()),t.set_item("AttachmentDescription",i.Descr()),t.set_item("AttachmentDocumentTypeLink",i.DType()),t.update())}}return e}function ot(){$.ajax({url:encodeURI(_spPageContextInfo.webAbsoluteUrl+"/_api/web/getuserbyid("+_spPageContextInfo.userId+")"),contentType:"application/json;odata=verbose",headers:{accept:"application/json;odata=verbose"},success:function(n){n.d&&(v=n.d)},error:function(){}})}function s(n,t){var i,r,u;for(i in n){if(n[i].koItem.Id(n[i].spItem.get_id()),n[i].koItem.New=!1,r=new window.FileReader,u=n[i].koItem.File(),u==undefined)return;r.onerror=function(){alert("File read failed")};r.onload=function(n,i){var r=n.spItem.get_id(),u=i;return function(i){var f=ft(i.target.result),e="/_api/web/lists/GetByTitle('"+t+"')/items("+r+")/AttachmentFiles/add(FileName='"+u+"')",o=new SP.RequestExecutor(_spPageContextInfo.webAbsoluteUrl);o.executeAsync({url:_spPageContextInfo.webAbsoluteUrl+e,method:"POST",headers:{Accept:"application/json; odata=verbose"},binaryStringRequestBody:!0,body:f,state:"Update",success:function(n){return function(t){var i=JSON.parse(t.body);n.koItem.FileName(i.d.FileName);n.koItem.FileUrl(_spPageContextInfo.siteAbsoluteUrl+i.d.ServerRelativeUrl)}}(n)})}}(n[i],u.name);r.readAsArrayBuffer(u)}}function st(n){var u=$.appWebContext.get_web().get_lists().getByTitle("Записи журналов поручений"),t,i,r;for(t in n)for(i in n[t].assignmentJournal())n[t].assignmentJournal()[i].New&&(r=u.addItem(new SP.ListItemCreationInformation),r.set_item("AssignmentLink",n[t].Id()),r.set_item("AssignmentJournalEntryDescr",n[t].assignmentJournal()[i].AssignmentJournalEntryDescr()),r.update(),n[t].assignmentJournal()[i].New=!1)}function ht(n){var f=$.appWebContext.get_web().get_lists().getByTitle("Отчеты по поручениям"),e=[],u,o,r,i;for(u in n)for(o in n[u].assignmentReports())r=n[u].assignmentReports()[o],r._destroy?r.Id()!=""&&(i=f.getItemById(r.Id()),i.deleteObject()):r.Id()==""?(i=f.addItem(new SP.ListItemCreationInformation),t(modelMetaData.assignmentReport.fields,r,i),i.set_item("AssignmentLink",n[u].Id()),i.update(),e.push({spItem:i,koItem:r}),$.appWebContext.load(i)):(i=f.getItemById(r.Id()),t(modelMetaData.assignmentReport.fields,r,i),i.update());return e}function ct(n,t){var c=null,e,o,s,h,l;if(n!="AssignmentLink"&&n!="AssignmentDependencyType"){var i=t[n]()==null?"":t[n](),r=t["edit"+n]()==null?"":t["edit"+n](),f="";switch(n){case"AssignmentNumber":i.toString()!=r.toString()&&(f="Номер - "+i.toString()+" -> "+r.toString());break;case"AssignmentText":i.toString()!=r.toString()&&(f="Текст поручения - "+i.toString()+" -> "+r.toString());break;case"AssignmentNote":i.toString()!=r.toString()&&(f="Примечание - "+i.toString()+" -> "+r.toString());break;case"AssignmentPredecessorLinkValue":i.toString()!=r.toString()&&(f="Зависимое поручение - "+i.toString()+" -> "+r.toString());break;case"AssignmentCreationDate":i.toString()!=r.toString()&&(f="Дата создания - "+i.toString()+" -> "+r.toString());break;case"AssignmentPlanDate":i.toString()!=r.toString()&&(f="Планируемая дата исполнения - "+i.toString()+" -> "+r.toString());break;case"AssignmentFactDate":i.toString()!=r.toString()&&(f="Фактическая дата исполнения - "+i.toString()+" -> "+r.toString());break;case"AssignmentDaysForResolve":i.toString()!=r.toString()&&(f="Количество дней на решение - "+i.toString()+" -> "+r.toString());break;case"AssignmentStatus":i.toString()!=r.toString()&&(f="Статус - "+i.toString()+" -> "+r.toString());break;case"AssignmentInspectState":i.toString()!=r.toString()&&(f="Состояние контроля - "+i.toString()+" -> "+r.toString());break;case"AssignmentDayType":i.toString()!=r.toString()&&(f="Тип дней - "+i.toString()+" -> "+r.toString());break;case"AssignmentExecutorFullNameLink":e=t.AssignmentExecutorFullNameLinkValue()==null?"":t.AssignmentExecutorFullNameLinkValue().toString();o=t.editAssignmentExecutorFullNameLinkValue()==null?"":t.editAssignmentExecutorFullNameLinkValue().toString();e!=o&&(f="Исполнитель - "+e+" -> "+o);break;case"AgendaQuestionLink":e=t.AgendaQuestionLinkValue()==null?"":t.AgendaQuestionLinkValue().toString();o=t.editAgendaQuestionLinkValue()==null?"":t.editAgendaQuestionLinkValue().toString();e!=o&&(f="Вопрос повестки - "+e+" -> "+o);break;case"AssignmentSoexecutors":i.toString()!=r.toString()&&(f="Соисполнители")}f!=""&&(s=u(modelMetaData.assignmentJournal.fields),h=v.LoginName.split("|"),s.Author=h.length>1?h[1]:h[0],l=new Date,s.CreatedDate=l.format("dd/MM/yy"),c=new ii(s),c.AssignmentJournalEntryDescr(f))}return c}function lt(t,i,r){var u={title:t,url:r?_spPageContextInfo.webAbsoluteUrl+"/_layouts/15/SAMRT.Web/Pages/ParticipantsSelection.aspx?Multi=1":_spPageContextInfo.webAbsoluteUrl+"/_layouts/15/SAMRT.Web/Pages/ParticipantsSelection.aspx",width:800,height:400,dialogReturnValueCallback:function(n,t){h(n,t,i)}};SP.UI.ModalDialog.showModalDialog(u);n()}function at(t,i){var r={title:t,url:_spPageContextInfo.webAbsoluteUrl+String.format("/_layouts/15/SAMRT.Web/Pages/IssueAttachmentMVK.aspx?ID={0}",i),width:800,height:400,dialogReturnValueCallback:function(){}};SP.UI.ModalDialog.showModalDialog(r);n()}function vt(t,i){var r,u;i.agendaQuestionObjects().length!=0&&(r=_spPageContextInfo.webAbsoluteUrl,r=i.agendaQuestionObjects().length>1?r+String.format("/Lists/IssueObjectMVKList/AllItems.aspx?FilterField1=IssueObjectIssueIdMVK&FilterValue1={0}",i.Id()):r+String.format("/Lists/Object/DispForm.aspx?ID={0}",i.agendaQuestionObjects()[0].IssueObjectIssueIdMVK().get_lookupId()),u={title:t,url:r,width:1024,height:768,autoSize:!1,allowMaximize:!0,dialogReturnValueCallback:function(){}},SP.UI.ModalDialog.showModalDialog(u),n())}function yt(t){var i={title:t,url:_spPageContextInfo.webAbsoluteUrl+"/Lists/OrderMVKList/Unused.aspx",width:1024,height:768,dialogReturnValueCallback:function(n,t){if(n==SP.UI.DialogResult.OK&&t.length>0){console.log(t);var r=_spPageContextInfo.webServerRelativeUrl+_spPageContextInfo.serverRequestPath+"/AddOrdersRg",i={meetingRgId:$.listItemId};i.orderRgIdList=[];t.map(function(n){i.orderRgIdList.push(n.id)});$.ajax({url:encodeURI(r),data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json",type:"POST",success:function(t){console.log(t);SP.UI.ModalDialog.RefreshPage(n)},error:function(n){console.log("RequestError! "+n)}})}}};SP.UI.ModalDialog.showModalDialog(i);n()}function pt(t){var i={title:t,url:_spPageContextInfo.webAbsoluteUrl+"/Lists/IssueMVKList/NewForm2.aspx",width:1024,height:768,dialogReturnValueCallback:function(n){SP.UI.ModalDialog.RefreshPage(n)}};SP.UI.ModalDialog.showModalDialog(i);n()}function wt(n){var t=new SP.FieldLookupValue;return t.set_lookupId(n),t}function n(){}function h(n,t,i){n==SP.UI.DialogResult.OK&&$(i).val(t).change()}function bt(n){for(var t in modelMetaData)modelMetaData[t].contentTypes=o(modelMetaData[t].listName).get_contentTypes(),$.appWebContext.load(modelMetaData[t].contentTypes);$.appWebContext.executeQueryAsync(function(){var t,i;for(t in modelMetaData){for(i=0;i<modelMetaData[t].contentTypes.get_count();i++)if(!modelMetaData[t].contentTypes.getItemAtIndex(i).get_sealed()){modelMetaData[t].contentType=modelMetaData[t].contentTypes.getItemAtIndex(i);break}modelMetaData[t].fields=modelMetaData[t].contentType.get_fields();$.appWebContext.load(modelMetaData[t].fields)}$.appWebContext.executeQueryAsync(function(){var t,u,i,r;for(t in modelMetaData){for(u=[],i=0;i<modelMetaData[t].fields.get_count();i++)(r=modelMetaData[t].fields.getItemAtIndex(i).get_internalName(),r.toLowerCase().indexOf("__x")>0||r=="AgendaQuestionDeclarant"||r=="ContentType")||u.push(modelMetaData[t].fields.getItemAtIndex(i));modelMetaData[t].fields=u}n([])},function(n,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})},function(n,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}function w(n,t){var i={FileUrl:"",FileName:""},r=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/getById('"+n+"')/items("+t+")/AttachmentFiles";return $.ajax({url:encodeURI(r),headers:{Accept:"application/json;odata=verbose"},method:"GET",async:!1,success:function(n){n&&n.d.results.length>0&&(i.FileUrl=_spPageContextInfo.siteAbsoluteUrl+n.d.results[0].ServerRelativeUrl,i.FileName=n.d.results[0].FileName)}}),i}function kt(n){var t=[],u=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/getByTitle('Вложения отчета по поручению')/items?$select=ID,AssignmentReportLink/Id,AttachmentDescription,AttachmentDocumentTypeLink/Id,AttachmentIsForReport&$expand=AttachmentFiles,AssignmentReportLink,AttachmentDocumentTypeLink&$filter=AssignmentReportLink/Id eq "+n;return $.ajax({url:encodeURI(u),headers:{Accept:"application/json;odata=verbose"},method:"GET",async:!1,success:function(n){if(n)for(i=0;i<n.d.results.length;i++){var u=w("Вложения отчета по поручению",n.d.results[i].ID);t.push(new r({AttachmentDescription:n.d.results[i].AttachmentDescription,MeetingLink:n.d.results[i].AssignmentReportLink.Id,Id:n.d.results[i].ID,FileUrl:u.FileUrl,FileName:u.FileName,FilePath:"",AttachmentDocumentTypeLinkValue:n.d.results[i].AttachmentDocumentTypeLink.Id?n.d.results[i].AttachmentDocumentTypeLink.Id:"",AttachmentIsForReport:n.d.results[i].AttachmentIsForReport,New:!1}))}}}),t}function dt(n){var u=[],f;if(n!=null){var r="",t=[];if($.each(n,function(){t.push(this.get_lookupId())}),t=$.unique(t),t.length>0)r="&$filter=Id eq "+t[0];else return[];for(i=1;i<t.length;i++)r+="or Id eq "+t[i];f=_spPageContextInfo.webAbsoluteUrl+"/_api/web/lists/getByTitle('Справочник участников')/items?$select=ParticipantFullName,ParticipantPositionLink/Title,ParticipantOrgLink/OrganizationName,ParticipantRole,ID&$expand=ParticipantPositionLink,ParticipantOrgLink"+r;$.ajax({url:encodeURI(f),headers:{Accept:"application/json;odata=verbose"},method:"GET",async:!1,success:function(n){if(n.d)for(i=0;i<n.d.results.length;i++)u.push(new b(n.d.results[i]))}})}return u}function gt(n){this.Id=n.Id;this.Name=n.QuestionCategoryName}function ni(n){this.Id=n.Id;this.Value=n.Value;this.Unit=n.Unit}function ti(n){this.Id=n.Id;this.AssignmentTypeName=n.AssignmentTypeName;this.AssignmentTypeDescr=n.AssignmentTypeDescr}function c(n){var t,i;for(t in n)t=="New"?this[t]=n[t]:t=="Id"?this[t]=ko.observable(n[t]):(t.toLowerCase().endsWith("link")&&(this[t+"Value"]=ko.observable(n[t]?n[t].get_lookupValue():null),this[t+"Id"]=ko.observable(n[t]?n[t].get_lookupId():null),this["edit"+t+"Value"]=ko.observable(n[t]?n[t].get_lookupValue():null),this["edit"+t+"Id"]=ko.observable(n[t]?n[t].get_lookupId():null)),this[t]=ko.observable(n[t]),this["edit"+t]=ko.observable(n[t]));i=this.Id()>0?kt(this.Id()):null;this.reportAttachments=i!=null?ko.observableArray(i):ko.observableArray([]);this.editReportAttachments=i!=null?ko.observableArray(i):ko.observableArray([]);this.editReportAttachmentsFiltered=function(){return ko.utils.arrayFilter(this.editReportAttachments(),function(n){return n.IsForReport()})};this.editRequestAttachmentsFiltered=function(){return ko.utils.arrayFilter(this.editReportAttachments(),function(n){return!n.IsForReport()})};this.removeReportAttach=function(n){this.editReportAttachments.destroy(n)}.bind(this);this.addRequestAttach=function(){this.doAddReportAttach(!1)};this.addReportAttach=function(){this.doAddReportAttach(!0)};this.doAddReportAttach=function(n){this.editReportAttachments.push(new r({Id:"",AttachmentDescription:"",MeetingLink:this.Id(),FileUrl:"",FileName:"",FilePath:"",AttachmentDocumentTypeLinkValue:"",AttachmentIsForReport:n,New:!0}))}.bind(this);this.accept=function(){for(var t in n)t!="New"&&t!="Id"&&(t.toLowerCase().endsWith("link")&&(this[t+"Value"](this["edit"+t+"Value"]()),this[t+"Id"](this["edit"+t+"Id"]())),this[t](this["edit"+t]()));this.reportAttachments(this.editReportAttachments())}.bind(this);this.cancel=function(){for(var t in n)t!="New"&&t!="Id"&&(t.toLowerCase().endsWith("link")&&(this["edit"+t+"Value"](this[t+"Value"]()),this["edit"+t+"Id"](this[t+"Id"]())),this["edit"+t](this[t]()));this.editReportAttachments(this.reportAttachments())}.bind(this)}function ii(n){for(var t in n)this[t]=t=="New"?n[t]:ko.observable(n[t])}function ri(t){var r=this;for(var f in t)f=="New"?r[f]=t[f]:f=="Id"?r[f]=ko.observable(t[f]):(f.toLowerCase().endsWith("link")&&(r[f+"Value"]=ko.observable(t[f]?t[f].get_lookupValue():null),r[f+"Id"]=ko.observable(t[f]?t[f].get_lookupId():null),r["edit"+f+"Value"]=ko.observable(t[f]?t[f].get_lookupValue():null),r["edit"+f+"Id"]=ko.observable(t[f]?t[f].get_lookupId():null)),r[f]=ko.observable(t[f]),r["edit"+f]=ko.observable(t[f]));r.selectedRequest=ko.observable(undefined);r.assignmentReports=ko.observableArray([]);r.assignmentJournal=ko.observableArray([]);r.editAssignmentReports=ko.observableArray([]);r.changedExecutor=ko.observable("");r.changedExecutorIsNull=ko.computed(function(){return!(r.editAssignmentExecutorFullNameLinkValue()||r.editAssignmentExecutorPositionLinkValue()||r.editAssignmentExecutorOrganizationLinkValue())},r);r.changedSoexecutors=ko.observable("");r.assignmentSoexecutors=ko.observableArray([]);r.changedAssignmentSoexecutors=ko.observableArray([]);r.loadExecutor=function(){if(r.editAssignmentExecutorFullNameLink()!=null){var n=$.grep(e,function(n){return n.Id().toString()==r.editAssignmentExecutorFullNameLinkId().toString()});n.length>0&&(r.AssignmentExecutorPositionLinkValue(n[0].ParticipantPosition()),r.editAssignmentExecutorPositionLinkValue(n[0].ParticipantPosition()),r.AssignmentExecutorOrganizationLinkValue(n[0].ParticipantOrg()),r.editAssignmentExecutorOrganizationLinkValue(n[0].ParticipantOrg()))}}.bind(r);r.loadSoexecutors=function(){if(r.AssignmentSoexecutors()!=null){var n=[];$.each(r.AssignmentSoexecutors(),function(){var i=this.get_lookupId(),t=$.grep(e,function(n){return n.Id().toString()==i.toString()});t.length>0&&n.push(t[0])});r.assignmentSoexecutors(n);r.changedAssignmentSoexecutors(n)}}.bind(r);r.selectExecutor=function(){var t={title:"Выбор исполнителя",url:_spPageContextInfo.webAbsoluteUrl+"/_layouts/15/SAMRT.Web/Pages/ExecutorSelection.aspx",width:800,height:400,dialogReturnValueCallback:function(n,t){h(n,t,"#hiddenExecutor")}};SP.UI.ModalDialog.showModalDialog(t);n()}.bind(r);r.selectSoexecutors=function(){var t={title:"Выбор соисполнителей",url:_spPageContextInfo.webAbsoluteUrl+"/_layouts/15/SAMRT.Web/Pages/ParticipantsSelection.aspx?Multi=1",width:800,height:400,dialogReturnValueCallback:function(n,t){h(n,t,"#hiddenSoexecutors")}};SP.UI.ModalDialog.showModalDialog(t);n()}.bind(r);r.onSoexecutorsChange=ko.computed(function(){var n,t,u;if(r.changedSoexecutors()!=""){for(n=$.parseJSON(r.changedSoexecutors()),i=0;i<n.length;i++)t=new b(n[i]),ko.utils.arrayFirst(r.changedAssignmentSoexecutors(),function(n){return t.Id()==n.Id()})||(r.changedAssignmentSoexecutors.push(t),r.editAssignmentSoexecutors()==null&&r.editAssignmentSoexecutors([]),u=new SP.FieldLookupValue,u.set_lookupId(n[i].Id),r.editAssignmentSoexecutors().push(u));r.changedSoexecutors("")}},r);r.onExecutorChange=ko.computed(function(){if(r.changedExecutor()!=""){var n=$.parseJSON(r.changedExecutor()),t=new SP.FieldLookupValue;t.set_lookupId(n.Id);r.editAssignmentExecutorFullNameLinkValue(n.FullName);r.editAssignmentExecutorFullNameLinkId(n.Id);r.editAssignmentExecutorPositionLinkValue(n.Position);r.editAssignmentExecutorPositionLinkId(n.Id);r.editAssignmentExecutorOrganizationLinkValue(n.Org);r.editAssignmentExecutorOrganizationLinkId(n.Id);switch(n.ExecutorType){case"FIO":r.editAssignmentExecutorFullNameLink(t);r.editAssignmentExecutorPositionLink(null);r.editAssignmentExecutorOrganizationLink(null);break;case"Position":r.editAssignmentExecutorFullNameLink(null);r.editAssignmentExecutorPositionLink(t);r.editAssignmentExecutorOrganizationLink(null);break;case"Organization":r.editAssignmentExecutorFullNameLink(null);r.editAssignmentExecutorPositionLink(null);r.editAssignmentExecutorOrganizationLink(t)}r.changedExecutor("")}},r);r.accept=function(){var n,i;for(n in t)n!="New"&&n!="Id"&&(i=ct(n,r),i!=null&&r.assignmentJournal.push(i),n.toLowerCase().endsWith("link")&&(r[n+"Value"](r["edit"+n+"Value"]()),r[n+"Id"](r["edit"+n+"Id"]())),r[n](r["edit"+n]()));r.assignmentSoexecutors(r.changedAssignmentSoexecutors());r.assignmentReports(r.editAssignmentReports())}.bind(r);r.cancel=function(){for(var n in t)n!="New"&&n!="Id"&&(n.toLowerCase().endsWith("link")&&(r["edit"+n+"Value"](r[n+"Value"]()),r["edit"+n+"Id"](r[n+"Id"]())),r["edit"+n](r[n]()));r.changedAssignmentSoexecutors(r.assignmentSoexecutors());r.editAssignmentReports(r.assignmentReports())}.bind(r);r.assignmentTypeComputed=ko.computed({read:function(){return r.editAssignmentTypeLink()?r.editAssignmentTypeLink().get_lookupId():""},write:function(n){r.editAssignmentTypeLink(wt(n));r.editAssignmentTypeLinkId(n)}},r);r.removeAssignSoexecutor=function(n){r.changedAssignmentSoexecutors.remove(n);this.editAssignmentSoexecutors($.grep(this.editAssignmentSoexecutors(),function(t){return t.get_lookupId().toString()!=n.Id().toString()}))}.bind(r);r.removeRequest=function(n){r.editAssignmentReports.destroy(n)}.bind(r);r.editRequest=function(n){r.selectedRequest(n)}.bind(r);r.acceptRequest=function(){var n=r.selectedRequest(),t,i;n.accept();n.New&&(t=d(modelMetaData.assignmentReport.fields,n),t.Id="",t.New=!1,i=new c(t),i.reportAttachments(n.reportAttachments()),i.editReportAttachments(n.reportAttachments()),r.editAssignmentReports.push(i));r.selectedRequest(undefined)};r.cancelRequest=function(){r.selectedRequest().cancel();r.selectedRequest(undefined)};r.addRequest=function(){var n=u(modelMetaData.assignmentReport.fields),t=new Date;n.AssignmentReportRequestDate=t.format("dd/MM/yyyy");r.selectedRequest(new c(n));selectRequestsTab("tab-request-request")};r.addReport=function(){var n=u(modelMetaData.assignmentReport.fields),t=new Date;n.AssignmentReportFactAnswerDate=t.format("dd/MM/yyyy");r.selectedRequest(new c(n));selectRequestsTab("tab-request-report")}}function l(n){for(var t in n)t=="New"?this[t]=n[t]:t=="Id"?this[t]=ko.observable(n[t]):(this[t]=ko.observable(n[t]),this["edit"+t]=ko.observable(n[t]),t=="AgendaLinkedQuestionLink"&&(this[t+"Value"]=ko.observable(n[t]?n[t].get_lookupValue():null),this[t+"Id"]=ko.observable(n[t]?n[t].get_lookupId():null),this["edit"+t+"Value"]=ko.observable(n[t]?n[t].get_lookupValue():null),this["edit"+t+"Id"]=ko.observable(n[t]?n[t].get_lookupId():null)));this.calcContent=ko.computed(function(){var n="";return n+=this.IssueAddressMVK()?"Адрес объекта: "+this.IssueAddressMVK()+";":"",n||this.IssueDescriptionMVK()},this);this.calcReporters=ko.computed(function(){var n=[];return this.IssueReporterRg()?n.push(this.IssueReporterRg().trim()):this.IssueReporterMVK&&this.IssueReporterMVK()&&n.push(this.IssueReporterMVK().get_lookupValue().trim()),this.agendaQuestionSoreporters&&this.agendaQuestionSoreporters()!=null&&this.agendaQuestionSoreporters().length>0?$.each(this.agendaQuestionSoreporters(),function(){n.push(this.ParticipantFullName().trim())}):this.IssueCoReportesMVK()!=null&&$.each(this.IssueCoReportesMVK(),function(){n.push(this.get_lookupValue().trim())}),n.join("; ")},this);this.mode=ko.observable("full");this.httpLink=ko.observable(String.format("{0}//{1}/sites/gca/Lists/IssueMVKList/DispForm2.aspx?ID={2}&ContentTypeId={3}",window.location.protocol,window.location.host,n.Id,modelMetaData.agendaQuestion.ctId));this.gotoEditQuestion=function(){window.open(_spPageContextInfo.webAbsoluteUrl+"/Lists/IssueMVKList/DispForm2.aspx?ID="+n.Id,"_blank")};this.changedReporter=ko.observable("");this.changedSoreporters=ko.observable("");this.agendaQuestionObjects=ko.observableArray([]);this.agendaQuestionMeasures=ko.observableArray([]);this.agendaQuestionMeasures(null);this.agendaQuestionAttachments=ko.observableArray([]);this.editAgendaQuestionAttachments=ko.observableArray([]);this.agendaQuestionReporterFIO=ko.observable();this.editAgendaQuestionReporterFIO=ko.observable();this.agendaQuestionReporterPosition=ko.observable();this.editAgendaQuestionReporterPosition=ko.observable();this.agendaQuestionReporterOrganizationName=ko.observable();this.editAgendaQuestionReporterOrganizationName=ko.observable();this.changedReporterIsNull=ko.computed(function(){return!(this.editAgendaQuestionReporterFIO()||this.editAgendaQuestionReporterPosition()||this.editAgendaQuestionReporterOrganizationName())},this);this.agendaQuestionSoreporters=ko.observableArray([]);this.editAgendaQuestionSoreporters=ko.observableArray([]);this.loadReporter=function(){if(this.AgendaQuestionReporterFullNameLink()!=null){var t=this.AgendaQuestionReporterFullNameLink().get_lookupId(),n=$.grep(e,function(n){return n.Id().toString()==t.toString()});n.length>0&&(this.agendaQuestionReporterFIO(n[0].ParticipantFullName()),this.editAgendaQuestionReporterFIO(n[0].ParticipantFullName()),this.agendaQuestionReporterPosition(n[0].ParticipantPosition()),this.editAgendaQuestionReporterPosition(n[0].ParticipantPosition()),this.agendaQuestionReporterOrganizationName(n[0].ParticipantOrg()),this.editAgendaQuestionReporterOrganizationName(n[0].ParticipantOrg()))}}.bind(this);this.loadSoreporters=function(){if(this.AgendaQuestionSoreporterFullNameLink()!=null){var n=[];$.each(this.AgendaQuestionSoreporterFullNameLink(),function(){var i=this.get_lookupId(),t=$.grep(e,function(n){return n.Id().toString()==i.toString()});t.length>0&&n.push(t[0])});this.agendaQuestionSoreporters(n);this.editAgendaQuestionSoreporters(n)}}.bind(this);this.selectReporter=function(){lt("Выбор докладчика","#hiddenReporter",!1)}.bind(this);this.showAttachments=function(){at(String.format("Вложения вопроса повестки №{0}",n.IssueNumberMVK),n.Id)};this.showObjects=function(){vt(String.format("Объекты вопроса повестки №{0}",n.IssueNumberTextMVK),n.Id)};this.editQuestionComment=function(){ShowCommentWindow(this)}}function ui(n){for(var t in n)t=="New"?this[t]=n[t]:t=="Id"?this[t]=ko.observable(n[t]):(this[t]=ko.observable(n[t]),this["edit"+t]=ko.observable(n[t]),t=="AgendaLinkedQuestionLink"&&(this[t+"Value"]=ko.observable(n[t]?n[t].get_lookupValue():null),this[t+"Id"]=ko.observable(n[t]?n[t].get_lookupId():null),this["edit"+t+"Value"]=ko.observable(n[t]?n[t].get_lookupValue():null),this["edit"+t+"Id"]=ko.observable(n[t]?n[t].get_lookupId():null)))}function r(n){this.Id=ko.observable(n.Id);this.Descr=ko.observable(n.AttachmentDescription);this.MeetingLink=ko.observable(n.MeetingLink);this.FileUrl=ko.observable(n.FileUrl);this.FileName=ko.observable(n.FileName);this.FilePath=ko.observable(n.FilePath);this.DType=ko.observable(n.AttachmentDocumentTypeLinkValue);this.IsForReport=ko.observable(n.AttachmentIsForReport);this.New=n.New;this.File=ko.observable();this.selectedFile=function(n){n.files==undefined?this.File=n.files:this.File(n.files[0])}.bind(this)}function b(n){this.Id=ko.observable(n.Id);this.ParticipantFullName=ko.observable(n.ParticipantFullName);this.ParticipantPosition=n.ParticipantPositionLink!=undefined?ko.observable(n.ParticipantPositionLink.Title):ko.observable(n.ParticipantPosition);this.ParticipantOrg=n.ParticipantOrgLink!=undefined?ko.observable(n.ParticipantOrgLink.OrganizationName):ko.observable(n.ParticipantOrg);this.ParticipantRole=ko.observable(n.ParticipantRole)}function k(n){for(var t in n)this[t]=t=="New"?n[t]:ko.observable(n[t]);this.changeTitle=ko.computed(function(){var n=this.MeetingNumberMVK(),t=new Date,i=this.CreatedDate==undefined?t.getFullYear():+this.CreatedDate().split("/")[2];this.Title(n+"-"+i)},this)}function a(n,t){for(var i,r={},u=0;u<n.length;u++)if(i=n[u].get_internalName(),i.toLowerCase().indexOf("date")>=0&&t.get_item(i)&&t.get_item(i).get_lookupValue==undefined)r[i]=y(t.get_item(i));else try{r[i]=t.get_item(i)}catch(f){console&&console.log("Не удалось обнаружить поле "+i+": "+f.message)}r.Id=t.get_item("ID");try{r.Author=t.get_item("Author").get_lookupValue()}catch(f){console&&console.log("Не удалось обнаружить поле Author: "+f.message)}return r.CreatedDate=y(t.get_item("Created")),r.New=!1,r}function t(n,t,i){for(var r,u=0;u<n.length;u++)r=n[u].get_internalName(),r.toLowerCase().indexOf("date")>=0?t[r]()?i.set_item(r,nt(t[r]())):i.set_item(r,null):i.set_item(r,t[r]())}function u(n){for(var r,t={},i=0;i<n.length;i++)r=n[i].get_internalName(),t[r]=n[i].get_defaultValue();return t.Id="",t.New=!0,t}function d(n,t){for(var r,u={},i=0;i<n.length;i++)r=n[i].get_internalName(),u[r]=t[r]();return u}function fi(){var n=this;n.initFileReader=function(){};n.allProjectsTypes=ko.observableArray([]);n.allQuestions=ko.observableArray([]);n.currentMeetingsNumber=ko.observable();n.meeting=ko.observable({});n.agendaQuestions=ko.observableArray([]);n.agendaQuestionObjects=ko.observableArray([]);n.agendaQuestionTypes=ko.observableArray([]);n.assignmentTypes=ko.observableArray([]);n.assignments=ko.observableArray([]);n.filteredAssignments=function(t){return ko.utils.arrayFilter(n.assignments(),function(n){return n.editAgendaQuestionLinkValue().toString()===t.toString()})};n.availableMeetingStatuses=ko.observableArray([]);n.assignmentStatuses=ko.observableArray([]);n.assignmentReportResolutions=ko.observableArray([]);n.assignmentInspectStates=ko.observableArray([]);n.assignmentDayTypes=ko.observableArray([]);n.availableAttachDocTypes=ko.observableArray([]);n.attachments=ko.observableArray([]);n.scanAttach=ko.observable(new r({AttachmentDescription:"",MeetingLink:"",Id:"",FileUrl:"",FileName:"",FilePath:"",AttachmentDocumentTypeLinkValue:"",New:!0}));n.editEnabled=ko.observable();n.isReporter=ko.observable();var h=o(modelMetaData.meeting.listName),i=o(modelMetaData.agendaQuestion.listName),b=o(modelMetaData.agendaQuestionObject.listName),f=o(modelMetaData.meetingAttachment.listName),c,nt=$.appWebContext.get_web().get_lists().getByTitle("Типы документов вложений"),y=$.appWebContext.get_web().get_lists().getByTitle("Типы проектов вопросов повестки"),v=new Spinner(g);bt(function(){ot();n.getPermissions();n.loadData()});n.getPermissions=function(){n.editEnabled(!1)};n.loadData=function(){var o,s,et,c,p,ot,d,g,t;n.availableMeetingStatuses(it(modelMetaData.meeting.fields,"MeetingStatusMVK"));var tt=new SP.CamlQuery,rt=nt.getItems(tt),ft=y.getItems(tt);$.appWebContext.load(rt);$.appWebContext.load(ft);$.appWebContext.executeQueryAsync(function(){for(var t=rt.getEnumerator(),i;t.moveNext();)n.availableAttachDocTypes().push({id:t.get_current().get_item("ID"),name:t.get_current().get_item("Title")});for(t=ft.getEnumerator(),i=[];t.moveNext();)i.push({label:t.get_current().get_item("Title"),value:t.get_current().get_item("Title")});n.allProjectsTypes(i)});n.currentMeetingsNumber(ut());$.pageMode=="new"||$.listItemId=="undefined"?(n.meeting(new k(u(modelMetaData.meeting.fields))),n.meeting().MeetingNumber(n.currentMeetingsNumber()+1)):(o=new SP.CamlQuery,o.set_viewXml("<View><Query><Where><Eq><FieldRef Name='ID'/><Value Type='Text'>"+$.listItemId+"<\/Value><\/Eq><\/Where><\/Query><\/View>"),s=h.getItems(o),$.appWebContext.load(s),et=(new CamlBuilder).Where().LookupField("IssueMeetingMVK").Id().EqualTo($.listItemId).OrderBy("IssueNumberMVK"),c=new SP.CamlQuery,c.set_viewXml("<View><Query>"+et.ToString()+"<\/Query><\/View>"),p=i.getItems(c),$.appWebContext.load(p),ot=(new CamlBuilder).Where().LookupField("MeetingAttachmentMeetingMVK").Id().EqualTo($.listItemId),d=new SP.CamlQuery,d.set_viewXml("<View><Query>"+ot.ToString()+"<\/Query><\/View>"),g=f.getItems(d),$.appWebContext.load(g),t=document.getElementById("AgendaQuestionTableDiv"),t&&($(t.children).each(function(n,t){$(t).hide()}),$(t).css("min-height","150px"),v.spin(t)),$.appWebContext.executeQueryAsync(function(){var u,c,y,d,nt,tt,ut,it,rt;try{n.meeting(new k(a(modelMetaData.meeting.fields,s.get_data()[0])));for(var o=[],h=[],i=p.getEnumerator();i.moveNext();)u=new l(a(modelMetaData.agendaQuestion.fields,i.get_current())),u.IssueReporterMVK&&u.IssueReporterMVK()!=null&&h.push(u.IssueReporterMVK()),u.IssueCoReportesMVK()!=null&&$.each(u.IssueCoReportesMVK(),function(){h.push(this)}),o.push(u);for(n.agendaQuestions(o),c=[],i=g.getEnumerator();i.moveNext();)nt=i.get_current().get_item("MeetingAttachmentDocTypeMVK"),tt=w(f.get_id().toString(),i.get_current().get_item("ID")),d=new r({AttachmentDescription:i.get_current().get_item("MeetingAttachmentDescriptionMVK"),MeetingLink:i.get_current().get_item("MeetingAttachmentMeetingMVK"),Id:i.get_current().get_item("ID"),FileUrl:tt.FileUrl,FileName:tt.FileName,FilePath:"",AttachmentDocumentTypeLinkValue:nt?nt.get_lookupId():"",New:!1}),i.get_current().get_item("MeetingAttachmentProtocolCopyMVK")?y=d:c.push(d);n.attachments(c);y&&n.scanAttach(y);ut=(new CamlBuilder).Where().LookupField("_x0412__x043e__x043f__x0440__x04").Id().In($.map(n.agendaQuestions(),function(n){return n.Id()}));it=new SP.CamlQuery;it.set_viewXml("<View><Query>"+ut.ToString()+"<\/Query><\/View>");rt=b.getItems(it);$.appWebContext.load(rt);$.appWebContext.executeQueryAsync(function(){for(var t=[],y=[],c=rt.getEnumerator(),u,l,r,f,s,i,v;c.moveNext();)u=a(modelMetaData.agendaQuestionObject.fields,c.get_current()),l=new ui(u),y.push(u),t.push(l);for(n.agendaQuestionObjects(t),r=0;r<o.length;r++){for(f=o[r],i=0;i<t.length;i++)t[i]._x0412__x043e__x043f__x0440__x04().get_lookupId()==f.Id()&&(s=t[i]);s&&f.agendaQuestionObjects.push(s)}v=[];n.assignments(v);e=dt(h);$.each(n.agendaQuestions(),function(){this.loadReporter();this.loadSoreporters()});$.each(n.assignments(),function(){this.loadExecutor();this.loadSoexecutors()})})}catch(ft){alert(ft.message)}finally{v.stop();t&&($(t.children).each(function(n,t){$(t).show()}),$(t).css("min-height","0px"))}},function(n,i){v.stop();t&&($(t.children).each(function(n,t){$(t).show()}),$(t).css("min-height","0px"));alert("Request failed. "+i.get_message()+"\n"+i.get_stackTrace())}))};n.selectedAgendaQuestion=ko.observable();n.selectedAssignment=ko.observable();n.editAssignment=function(t){t.selectedRequest(undefined);n.selectedAssignment(t)};n.addAssignment=function(){var t=u(modelMetaData.assignment.fields),i=new ri(t);n.selectedAssignment(i);n.selectedAssignment().editAssignmentNumber(n.assignments().length+1);n.selectedAssignment().Id("");n.assignments.push(n.selectedAssignment())};n.removeAssignment=function(t){n.assignments.destroy(t)};n.acceptAssignment=function(){var t=n.selectedAssignment();p(t.editAssignmentNumber())?(t.accept(),t.New&&(t.New=!1),n.selectedAssignment("")):alert("Номер поручения должен быть числом > 0!")};n.cancelAssignment=function(){n.selectedAssignment().New?n.assignments.remove(n.selectedAssignment()):n.selectedAssignment().cancel();n.selectedAssignment("")};n.editAgendaQuestion=function(t){t.mode("full");n.selectedAgendaQuestion(t)};n.editAgendaQuestionOnlyFiles=function(t){t.mode("onlyFiles");n.selectedAgendaQuestion(t)};n.addAgendaQuestion=function(){var t=u(modelMetaData.agendaQuestion.fields);t.MeetingLink=n.meeting().MeetingNumber();n.selectedAgendaQuestion(new l(t));n.selectedAgendaQuestion().editAgendaQuestionNumber(n.agendaQuestions().length+1);n.selectedAgendaQuestion().mode("full")};n.addOrderRg=function(){yt("Добавить заявки Рабочей группы")};n.createIssueRg=function(){pt("Создать вопрос Рабочей группы")};n.removeAgendaQuestion=function(t){for(var f,o=t.IssueNumberMVK(),r=n.agendaQuestions(),u=o,e=r.indexOf(t)+1;e<r.length;e++)f=i.getItemById(r[e].Id()),f.set_item("IssueNumberMVK",u),f.update(),u++;f=i.getItemById(t.Id());f.deleteObject();$.appWebContext.executeQueryAsync(function(){u=o;for(var i=r.indexOf(t)+1;i<r.length;i++)r[i].IssueNumberMVK(u),u++;n.agendaQuestions.remove(t)},function(n,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})};n.canMoveUpAgendaQuestion=function(t){return n.agendaQuestions().indexOf(t)>0};n.canMoveDownAgendaQuestion=function(t){return n.agendaQuestions().indexOf(t)<n.agendaQuestions().length-1};n.moveAgendaQuestion=function(t,r){console.log((r?"Up":"Down")+" question "+t.Id());var h=r?-1:1,u=n.agendaQuestions()[n.agendaQuestions().indexOf(t)+h],o=t.IssueNumberMVK(),s=u.IssueNumberMVK(),f=i.getItemById(t.Id()),e=i.getItemById(u.Id());$.appWebContext.load(e);$.appWebContext.load(f);$.appWebContext.executeQueryAsync(function(){console.log("Questions updated success");e.set_item("IssueNumberMVK",o);f.set_item("IssueNumberMVK",s);e.update();f.update();$.appWebContext.executeQueryAsync(function(){console.log("Move question "+t.Id()+" success");u.IssueNumberMVK(o);t.IssueNumberMVK(s);n.agendaQuestions(n.agendaQuestions().sort(function(n,t){return n.IssueNumberMVK()>t.IssueNumberMVK()?1:-1}))},function(n,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})},function(n,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})};n.moveUpAgendaQuestion=function(t){n.moveAgendaQuestion(t,!0)};n.moveDownAgendaQuestion=function(t){n.moveAgendaQuestion(t,!1)};n.acceptAgendaQuestion=function(){var r=n.selectedAgendaQuestion(),u,f;p(r.editAgendaQuestionNumber())?(r.accept(),r.New?(u=d(modelMetaData.agendaQuestion.fields,r),u.agendaQuestionReporterFIO=r.agendaQuestionReporterFIO(),u.agendaQuestionSoreporters=r.agendaQuestionSoreporters(),f=i.addItem(new SP.ListItemCreationInformation),t(modelMetaData.agendaQuestion.fields,r,f),f.update(),$.appWebContext.load(f),$.appWebContext.executeQueryAsync(function(){u.Id=f.get_id();u.New=!1;u.MeetingLink=n.meeting().MeetingNumber();n.agendaQuestions.push(new l(u));n.selectedAgendaQuestion("")})):n.selectedAgendaQuestion("")):alert("Номер вопроса должен быть числом > 0!")};n.cancelAgendaQuestion=function(){n.selectedAgendaQuestion().cancel();n.selectedAgendaQuestion("")};n.addAttach=function(){n.attachments.push(new r({Id:"",AttachmentDescription:"",MeetingLink:n.meeting().MeetingNumber(),FileUrl:"",FileName:"",FilePath:"",AttachmentDocumentTypeLinkValue:"",New:!0}))};n.removeAttach=function(t){n.attachments.destroy(t)};n.deleteScanAttach=function(){var t=f.getItemById(n.scanAttach().Id());t.deleteObject();$.appWebContext.executeQueryAsync(function(){n.scanAttach(new r({AttachmentDescription:"",MeetingLink:n.meeting().Id(),Id:"",FileUrl:"",FileName:"",FilePath:"",AttachmentDocumentTypeLinkValue:"",New:!0}))})};n.showPlaceOnMap=function(){n.meeting().MeetingPlace()!=""&&window.open("http://maps.yandex.ru/?text="+n.meeting().MeetingPlace(),"_blank")};n.closeForm=function(){window.location.href=$.backUrl};n.save=function(){var u,r,e;if(isNaN(n.meeting().MeetingNumber())){alert("Ошибка при сохранении! Номер заседания должен быть числом!");return}if(n.meeting().New){if(n.currentMeetingsNumber()>n.meeting().MeetingNumber()){alert("Ошибка при сохранении! Заданный номер заседания меньше последнего существующего!");return}rt(n.meeting().MeetingNumber());r=h.addItem(new SP.ListItemCreationInformation);t(modelMetaData.meeting.fields,n.meeting(),r);r.update();u=r;$.appWebContext.load(r)}else e=h.getItemById(n.meeting().Id()),t(modelMetaData.meeting.fields,n.meeting(),e),e.update();$.appWebContext.executeQueryAsync(function(){var b,h,a,l,o,v,p,w,e,r;u&&(n.meeting().Id(u.get_id()),n.meeting().New=!1);b=[];for(h in n.agendaQuestions())n.agendaQuestions()[h]._destroy?n.agendaQuestions()[h].Id()!=""&&(r=i.getItemById(n.agendaQuestions()[h].Id()),r.deleteObject()):(r=i.getItemById(n.agendaQuestions()[h].Id()),t(modelMetaData.agendaQuestion.fields,n.agendaQuestions()[h],r),r.set_item("MeetingLink",n.meeting().Id()),r.update(),a=tt(n.allProjectsTypes(),n.agendaQuestions()[h].AgendaQuestionProjectType(),y),a!=null&&n.allProjectsTypes.push({label:a,value:a}));l=[];for(o in n.assignments())n.assignments()[o]._destroy?n.assignments()[o].Id()!=""&&(r=c.getItemById(n.assignments()[o].Id()),r.deleteObject()):(r=n.assignments()[o].Id()==""?c.addItem(new SP.ListItemCreationInformation):c.getItemById(n.assignments()[o].Id()),t(modelMetaData.assignment.fields,n.assignments()[o],r),v=$.grep(n.agendaQuestions(),function(t){return t.AgendaQuestionNumber()==n.assignments()[o].AgendaQuestionLinkValue()}),v.length>0&&(v.length>1&&console.log("Duplicate agenda question numbers in this meeting"),r.set_item("AgendaQuestionLink",v[0].Id())),r.update(),n.assignments()[o].Id()==""&&(l.push({spItem:r,koItem:n.assignments()[o]}),$.appWebContext.load(r)));p=[];w=[];for(e in n.attachments())n.attachments()[e]._destroy?n.attachments()[e].Id()!=""&&(r=f.getItemById(n.attachments()[e].Id()),r.deleteObject()):(r=n.attachments()[e].Id()==""&&n.attachments()[e].File()!=undefined?f.addItem(new SP.ListItemCreationInformation):f.getItemById(n.attachments()[e].Id()),r.set_item("AttachmentDescription",n.attachments()[e].Descr()),r.set_item("MeetingLink",n.meeting().Id()),r.set_item("AttachmentDocumentTypeLink",n.attachments()[e].DType()),r.set_item("AttachmentProtocolScanCopy",!1),r.update(),n.attachments()[e].Id()==""&&n.attachments()[e].File()!=undefined&&(p.push({spItem:r,koItem:n.attachments()[e]}),$.appWebContext.load(r)));n.scanAttach()._destroy||n.scanAttach().File()!=undefined&&(r=n.scanAttach().Id()==""?f.addItem(new SP.ListItemCreationInformation):f.getItemById(n.scanAttach().Id()),r.set_item("AttachmentDescription",n.scanAttach().Descr()),r.set_item("MeetingLink",n.meeting().Id()),r.set_item("AttachmentProtocolScanCopy",!0),r.update(),n.scanAttach().Id()==""&&(w.push({spItem:r,koItem:n.scanAttach()}),$.appWebContext.load(r)));$.appWebContext.executeQueryAsync(function(){for(var r,i,t=n.agendaQuestions().length-1;t>=0;t--)n.agendaQuestions()[t]._destroy&&n.agendaQuestions.splice(t,1);s(w,"Вложения заседаний");s(p,"Вложения заседаний");for(r in l)l[r].koItem.Id(l[r].spItem.get_id()),l[r].koItem.New=!1;for(t=n.assignments().length-1;t>=0;t--)n.assignments()[t]._destroy&&n.assignments.splice(t,1);for(t=n.attachments().length-1;t>=0;t--)n.attachments()[t]._destroy&&n.attachments.splice(t,1);st(n.assignments());i=ht(n.assignments());$.appWebContext.executeQueryAsync(function(){var t,r;for(t in i)i[t].koItem.Id(i[t].spItem.get_id()),i[t].koItem.New=!1;r=et(n.assignments());$.appWebContext.executeQueryAsync(function(){s(r,"Вложения отчета по поручению");$.appWebContext.executeQueryAsync(function(){alert("Успешно сохранено")},function(){alert("Ошибка при сохранении вложений Отчетов!")})},function(){alert("Ошибка при сохранении вложений Отчетов!")})},function(){alert("Не могу сохранить данные отчётов!")})},function(n,t){alert("Ошибка обновления данных заседания");console.log(t.get_message())})},function(n,t){alert("Error saving new meeting");console.log(t.get_message())})}}function ei(n){f=$.appWebContext.get_web().get_lists();$.appWebContext.load(f,"Include(Id,EntityTypeName)");$.appWebContext.executeQueryAsync(function(){for(var i,t=0;t<f.get_count();t++)i=f.get_item(t),i.name=i.get_entityTypeName();n()},function(n,t){alert("Request failed. "+t.get_message()+"\n"+t.get_stackTrace())})}function o(n){for(var i,t=0;t<f.get_count();t++)if(i=f.get_item(t),i.name.indexOf(n)==0)return i;return console.log("Не найден список "+n),null}function oi(){$.appWebContext=SP.ClientContext.get_current();ei(function(){SP.SOD.executeOrDelayUntilScriptLoaded(function(){ko.applyBindings(new fi)},"sp.js")})}var g={lines:13,length:20,width:10,radius:30,corners:1,rotate:0,direction:1,color:"#000",speed:1.7,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},v,e=[],f;ko.bindingHandlers.iconButton={init:function(n,t){var i=t()||{};$(n).button(i)}};ko.bindingHandlers.datePicker={init:function(n,t){var i=t()||{};$(n).datepicker(i)}};ko.bindingHandlers.accordion={init:function(n,t){var i=t()||{};$(n).accordion(i)}};ko.bindingHandlers.jqDialog={init:function(n,t){var i=ko.utils.unwrapObservable(t())||{};ko.utils.domNodeDisposal.addDisposeCallback(n,function(){$(n).dialog("destroy")});$(n).dialog(i)}};ko.bindingHandlers.openDialog={update:function(n,t){var i=ko.utils.unwrapObservable(t());i?$(n).dialog("open"):$(n).dialog("close")}};ko.bindingHandlers.jqDialogButton={init:function(n,t){var i=ko.utils.unwrapObservable(t())||{};ko.utils.domNodeDisposal.addDisposeCallback(n,function(){$(n).button("destroy")});$(n).button(i)}};ko.bindingHandlers.showModal={init:function(){},update:function(n,t){var i=t();ko.utils.unwrapObservable(i)?$(n).modal("show"):$(n).modal("hide")}};ko.bindingHandlers.jqAuto={init:function(n,t){$(n).autocomplete(t())},update:function(n,t){$(n).autocomplete("option","source",t().source)}};$(document).ready(function(){$.hostweburl=decodeURIComponent($.getUrlVar("SPHostUrl"));$.pageMode=decodeURIComponent($.getUrlVar("mode"));$.backUrl=decodeURIComponent($.getUrlVar("Source"));$.listItemId=decodeURIComponent($.getUrlVar("ID"));moment.lang("ru");SP.SOD.executeFunc("sp.js","SP.ClientContext",oi)})})();
/*
//# sourceMappingURL=MeetingRg.min.js.map
*/